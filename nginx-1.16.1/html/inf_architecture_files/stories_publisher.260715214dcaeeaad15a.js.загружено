!function(e){function t(t){for(var n,i,s=t[0],c=t[1],u=t[2],d=0,f=[];d<s.length;d++)i=s[d],o[i]&&f.push(o[i][0]),o[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(l&&l(t);f.length;)f.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,s=1;s<r.length;s++){var c=r[s];0!==o[c]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={"web/stories_publisher":0},a=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([212,"bundles/common","bundles/vendors","bundles/4977ab57d813269ae3b1ad54250b95c9"]),r()}({"/MKj":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),a=r("17x9"),i=r.n(a),s=o.a.createContext(null);var c=function(e){e()},u=function(){return c},l=null,d={notify:function(){}};var f=function(){function e(e,t){this.store=e,this.parentSub=t,this.unsubscribe=null,this.listeners=d,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.handleChangeWrapper=function(){this.onStateChange&&this.onStateChange()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){var e,t,r;this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=(e=u(),t=[],r=[],{clear:function(){r=l,t=l},notify:function(){var n=t=r;e(function(){for(var e=0;e<n.length;e++)n[e]()})},get:function(){return r},subscribe:function(e){var n=!0;return r===t&&(r=t.slice()),r.push(e),function(){n&&t!==l&&(n=!1,r===t&&(r=t.slice()),r.splice(r.indexOf(e),1))}}}))},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=d)},e}(),p=function(e){var t,r;function n(t){var r;r=e.call(this,t)||this;var n=t.store;r.notifySubscribers=r.notifySubscribers.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r));var o=new f(n);return o.onStateChange=r.notifySubscribers,r.state={store:n,subscription:o},r.previousState=n.getState(),r}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var a=n.prototype;return a.componentDidMount=function(){this._isMounted=!0,this.state.subscription.trySubscribe(),this.previousState!==this.props.store.getState()&&this.state.subscription.notifyNestedSubs()},a.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe(),this.state.subscription.tryUnsubscribe(),this._isMounted=!1},a.componentDidUpdate=function(e){if(this.props.store!==e.store){this.state.subscription.tryUnsubscribe();var t=new f(this.props.store);t.onStateChange=this.notifySubscribers,this.setState({store:this.props.store,subscription:t})}},a.notifySubscribers=function(){this.state.subscription.notifyNestedSubs()},a.render=function(){var e=this.props.context||s;return o.a.createElement(e.Provider,{value:this.state},this.props.children)},n}(n.Component);p.propTypes={store:i.a.shape({subscribe:i.a.func.isRequired,dispatch:i.a.func.isRequired,getState:i.a.func.isRequired}),context:i.a.object,children:i.a.any};var h=p;function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function m(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}var v=r("2mql"),g=r.n(v),_=r("QLaP"),E=r.n(_),b=r("TOwV"),w=[],S=[null,null];function O(e,t){var r=e[1];return[t.payload,r+1]}var T=function(){return[null,0]},P="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?n.useLayoutEffect:n.useEffect;function C(e,t){void 0===t&&(t={});var r=t,a=r.getDisplayName,i=void 0===a?function(e){return"ConnectAdvanced("+e+")"}:a,c=r.methodName,u=void 0===c?"connectAdvanced":c,l=r.renderCountProp,d=void 0===l?void 0:l,p=r.shouldHandleStateChanges,h=void 0===p||p,v=r.storeKey,_=void 0===v?"store":v,C=r.withRef,x=void 0!==C&&C,L=r.forwardRef,N=void 0!==L&&L,k=r.context,R=void 0===k?s:k,D=m(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]);E()(void 0===d,"renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension"),E()(!x,"withRef is removed. To access the wrapped instance, use a ref on the connected component");E()("store"===_,"storeKey has been removed and does not do anything. To use a custom Redux store for specific components, create a custom React context with React.createContext(), and pass the context object to React Redux's Provider and specific components like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. You may also pass a {context : MyContext} option to connect");var I=R;return function(t){var r=t.displayName||t.name||"Component",a=i(r),s=y({},D,{getDisplayName:i,methodName:u,renderCountProp:d,shouldHandleStateChanges:h,storeKey:_,displayName:a,wrappedComponentName:r,WrappedComponent:t}),c=D.pure;var l=c?n.useMemo:function(e){return e()};function p(r){var i=Object(n.useMemo)(function(){var e=r.forwardedRef,t=m(r,["forwardedRef"]);return[r.context,e,t]},[r]),c=i[0],u=i[1],d=i[2],p=Object(n.useMemo)(function(){return c&&c.Consumer&&Object(b.isContextConsumer)(o.a.createElement(c.Consumer,null))?c:I},[c,I]),v=Object(n.useContext)(p),g=Boolean(r.store),_=Boolean(v)&&Boolean(v.store);E()(g||_,'Could not find "store" in the context of "'+a+'". Either wrap the root component in a <Provider>, or pass a custom React context provider to <Provider> and the corresponding React context consumer to '+a+" in connect options.");var C=r.store||v.store,x=Object(n.useMemo)(function(){return function(t){return e(t.dispatch,s)}(C)},[C]),L=Object(n.useMemo)(function(){if(!h)return S;var e=new f(C,g?null:v.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]},[C,g,v]),N=L[0],k=L[1],R=Object(n.useMemo)(function(){return g?v:y({},v,{subscription:N})},[g,v,N]),D=Object(n.useReducer)(O,w,T),j=D[0][0],A=D[1];if(j&&j.error)throw j.error;var M=Object(n.useRef)(),B=Object(n.useRef)(d),F=Object(n.useRef)(),U=Object(n.useRef)(!1),H=l(function(){return F.current&&d===B.current?F.current:x(C.getState(),d)},[C,j,d]);P(function(){B.current=d,M.current=H,U.current=!1,F.current&&(F.current=null,k())}),P(function(){if(h){var e=!1,t=null,r=function(){if(!e){var r,n,o=C.getState();try{r=x(o,B.current)}catch(e){n=e,t=e}n||(t=null),r===M.current?U.current||k():(M.current=r,F.current=r,U.current=!0,A({type:"STORE_UPDATED",payload:{latestStoreState:o,error:n}}))}};N.onStateChange=r,N.trySubscribe(),r();return function(){if(e=!0,N.tryUnsubscribe(),t)throw t}}},[C,N,x]);var Y=Object(n.useMemo)(function(){return o.a.createElement(t,y({},H,{ref:u}))},[u,t,H]);return Object(n.useMemo)(function(){return h?o.a.createElement(p.Provider,{value:R},Y):Y},[p,Y,R])}var v=c?o.a.memo(p):p;if(v.WrappedComponent=t,v.displayName=a,N){var C=o.a.forwardRef(function(e,t){return o.a.createElement(v,y({},e,{forwardedRef:t}))});return C.displayName=a,C.WrappedComponent=t,g()(C,t)}return g()(v,t)}}var x=Object.prototype.hasOwnProperty;function L(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function N(e,t){if(L(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++)if(!x.call(t,r[o])||!L(e[r[o]],t[r[o]]))return!1;return!0}var k=r("ANjH");function R(e){return function(t,r){var n=e(t,r);function o(){return n}return o.dependsOnOwnProps=!1,o}}function D(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function I(e,t){return function(t,r){r.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,r){n.mapToProps=e,n.dependsOnOwnProps=D(e);var o=n(t,r);return"function"==typeof o&&(n.mapToProps=o,n.dependsOnOwnProps=D(o),o=n(t,r)),o},n}}var j=[function(e){return"function"==typeof e?I(e):void 0},function(e){return e?void 0:R(function(e){return{dispatch:e}})},function(e){return e&&"object"==typeof e?R(function(t){return Object(k.bindActionCreators)(e,t)}):void 0}];var A=[function(e){return"function"==typeof e?I(e):void 0},function(e){return e?void 0:R(function(){return{}})}];function M(e,t,r){return y({},r,e,t)}var B=[function(e){return"function"==typeof e?function(e){return function(t,r){r.displayName;var n,o=r.pure,a=r.areMergedPropsEqual,i=!1;return function(t,r,s){var c=e(t,r,s);return i?o&&a(c,n)||(n=c):(i=!0,n=c),n}}}(e):void 0},function(e){return e?void 0:function(){return M}}];function F(e,t,r,n){return function(o,a){return r(e(o,a),t(n,a),a)}}function U(e,t,r,n,o){var a,i,s,c,u,l=o.areStatesEqual,d=o.areOwnPropsEqual,f=o.areStatePropsEqual,p=!1;function h(o,p){var h,y,m=!d(p,i),v=!l(o,a);return a=o,i=p,m&&v?(s=e(a,i),t.dependsOnOwnProps&&(c=t(n,i)),u=r(s,c,i)):m?(e.dependsOnOwnProps&&(s=e(a,i)),t.dependsOnOwnProps&&(c=t(n,i)),u=r(s,c,i)):v?(h=e(a,i),y=!f(h,s),s=h,y&&(u=r(s,c,i)),u):u}return function(o,l){return p?h(o,l):(s=e(a=o,i=l),c=t(n,i),u=r(s,c,i),p=!0,u)}}function H(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,o=t.initMergeProps,a=m(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),i=r(e,a),s=n(e,a),c=o(e,a);return(a.pure?U:F)(i,s,c,e,a)}function Y(e,t,r){for(var n=t.length-1;n>=0;n--){var o=t[n](e);if(o)return o}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+n.wrappedComponentName+".")}}function W(e,t){return e===t}var K,G,X,z,V,q,$,Z,J,Q,ee,te,re=(X=(G=void 0===K?{}:K).connectHOC,z=void 0===X?C:X,V=G.mapStateToPropsFactories,q=void 0===V?A:V,$=G.mapDispatchToPropsFactories,Z=void 0===$?j:$,J=G.mergePropsFactories,Q=void 0===J?B:J,ee=G.selectorFactory,te=void 0===ee?H:ee,function(e,t,r,n){void 0===n&&(n={});var o=n,a=o.pure,i=void 0===a||a,s=o.areStatesEqual,c=void 0===s?W:s,u=o.areOwnPropsEqual,l=void 0===u?N:u,d=o.areStatePropsEqual,f=void 0===d?N:d,p=o.areMergedPropsEqual,h=void 0===p?N:p,v=m(o,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),g=Y(e,q,"mapStateToProps"),_=Y(t,Z,"mapDispatchToProps"),E=Y(r,Q,"mergeProps");return z(te,y({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:g,initMapDispatchToProps:_,initMergeProps:E,pure:i,areStatesEqual:c,areOwnPropsEqual:l,areStatePropsEqual:f,areMergedPropsEqual:h},v))});function ne(){var e=Object(n.useContext)(s);return E()(e,"could not find react-redux context value; please ensure the component is wrapped in a <Provider>"),e}function oe(){return ne().store}function ae(){return oe().dispatch}var ie="undefined"!=typeof window?n.useLayoutEffect:n.useEffect,se=function(e,t){return e===t};function ce(e,t){void 0===t&&(t=se),E()(e,"You must pass a selector to useSelectors");var r,o=ne(),a=o.store,i=o.subscription,s=Object(n.useReducer)(function(e){return e+1},0)[1],c=Object(n.useMemo)(function(){return new f(a,i)},[a,i]),u=Object(n.useRef)(),l=Object(n.useRef)(),d=Object(n.useRef)();try{r=e!==l.current||u.current?e(a.getState()):d.current}catch(e){var p="An error occured while selecting the store state: "+e.message+".";throw u.current&&(p+="\nThe error may be correlated with this previous error:\n"+u.current.stack+"\n\nOriginal stack trace:"),new Error(p)}return ie(function(){l.current=e,d.current=r,u.current=void 0}),ie(function(){function e(){try{var e=l.current(a.getState());if(t(e,d.current))return;d.current=e}catch(e){u.current=e}s({})}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}},[a,c]),r}var ue,le=r("i8i4");r.d(t,"Provider",function(){return h}),r.d(t,"connectAdvanced",function(){return C}),r.d(t,"ReactReduxContext",function(){return s}),r.d(t,"connect",function(){return re}),r.d(t,"batch",function(){return le.unstable_batchedUpdates}),r.d(t,"useDispatch",function(){return ae}),r.d(t,"useSelector",function(){return ce}),r.d(t,"useStore",function(){return oe}),r.d(t,"shallowEqual",function(){return N}),ue=le.unstable_batchedUpdates,c=ue},"/TnQ":function(e,t,r){"use strict";var n=r("ANjH").compose;t.__esModule=!0,t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer=function(){return function(e){return e}}},"16Al":function(e,t,r){"use strict";var n=r("WbBG");function o(){}function a(){}a.resetWarningCache=o,e.exports=function(){function e(e,t,r,o,a,i){if(i!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:o};return r.PropTypes=r,r}},"17x9":function(e,t,r){e.exports=r("16Al")()},"1y80":function(e,t,r){"use strict";function n(e,t,r,n,o){return window.statlogsValueEvent(e,t,r,n,o)}function o(e){return Math.random()<e}function a(e,t,r,a,i,s){o(e)&&n(t,r,a,i,s)}r.r(t),r.d(t,"statlogsValueEvent",function(){return n}),r.d(t,"randEnabled",function(){return o}),r.d(t,"statlogsProbValueEvent",function(){return a})},212:function(e,t,r){e.exports=r("e9h0")},"2mql":function(e,t,r){"use strict";var n=r("TOwV"),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(e){return n.isMemo(e)?i:s[e.$$typeof]||o}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0};var u=Object.defineProperty,l=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(h){var o=p(r);o&&o!==h&&e(t,o,n)}var i=l(r);d&&(i=i.concat(d(r)));for(var s=c(t),y=c(r),m=0;m<i.length;++m){var v=i[m];if(!(a[v]||n&&n[v]||y&&y[v]||s&&s[v])){var g=f(r,v);try{u(t,v,g)}catch(e){}}}return t}return t}},"3UD+":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},"6raB":function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return u});r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("pemR")),a=r("KFTi"),i=r("Hx9h");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function c(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}class u extends n.Component{constructor(e){super(e),this.needRecalcSize=!1,this.state={}}render(){var e=this.props,t=e.className,r=e.loading,u=e.children,l=c(e,["className","loading","children"]),d=Object(o.classNames)("ButtonWithProgress",{"ButtonWithProgress--loading":r},t);return n.createElement(i.default,s({},l,{className:d}),n.createElement("span",{className:"ButtonWithProgress__content"},u),r&&n.createElement(a.default,{inverted:"primary"===e.appearance,className:"ButtonWithProgress__progress"}))}}u.defaultProps={appearance:"primary",size:"m",wide:!1,loading:!1}},ANjH:function(e,t,r){"use strict";r.r(t),r.d(t,"createStore",function(){return s}),r.d(t,"combineReducers",function(){return u}),r.d(t,"bindActionCreators",function(){return d}),r.d(t,"applyMiddleware",function(){return y}),r.d(t,"compose",function(){return h}),r.d(t,"__DO_NOT_USE__ActionTypes",function(){return a});var n=r("bCCX"),o=function(){return Math.random().toString(36).substring(7).split("").join(".")},a={INIT:"@@redux/INIT"+o(),REPLACE:"@@redux/REPLACE"+o(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+o()}};function i(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function s(e,t,r){var o;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(s)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var c=e,u=t,l=[],d=l,f=!1;function p(){d===l&&(d=l.slice())}function h(){if(f)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return u}function y(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(f)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return p(),d.push(e),function(){if(t){if(f)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,p();var r=d.indexOf(e);d.splice(r,1)}}}function m(e){if(!i(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(f)throw new Error("Reducers may not dispatch actions.");try{f=!0,u=c(u,e)}finally{f=!1}for(var t=l=d,r=0;r<t.length;r++){(0,t[r])()}return e}return m({type:a.INIT}),(o={dispatch:m,subscribe:y,getState:h,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");c=e,m({type:a.REPLACE})}})[n.default]=function(){var e,t=y;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(h())}return r(),{unsubscribe:t(r)}}})[n.default]=function(){return this},e},o}function c(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function u(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];0,"function"==typeof e[o]&&(r[o]=e[o])}var i,s=Object.keys(r);try{!function(e){Object.keys(e).forEach(function(t){var r=e[t];if(void 0===r(void 0,{type:a.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:a.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+a.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(r)}catch(e){i=e}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var n=!1,o={},a=0;a<s.length;a++){var u=s[a],l=r[u],d=e[u],f=l(d,t);if(void 0===f){var p=c(u,t);throw new Error(p)}o[u]=f,n=n||f!==d}return n?o:e}}function l(e,t){return function(){return t(e.apply(this,arguments))}}function d(e,t){if("function"==typeof e)return l(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),n={},o=0;o<r.length;o++){var a=r[o],i=e[a];"function"==typeof i&&(n[a]=l(i,t))}return n}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){f(e,t,r[t])})}return e}function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function y(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=t.map(function(e){return e(o)});return p({},r,{dispatch:n=h.apply(void 0,a)(r.dispatch)})}}}},Cb16:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return a});r("91GP");var n=r("q1tI");r("17x9");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class a extends n.Component{constructor(e){if(super(e),this.props.defaultValue<0||this.props.defaultValue>1)throw new Error("Bad defaultValue specified to Slider");this.containerRef=n.createRef()}componentDidUpdate(e){this.props.value!==e.value&&this.sliderElement.setValue(this.props.value,!0)}componentDidMount(){this.sliderElement=new window.Slider(this.containerRef.current,o({size:1,value:this.props.defaultValue,formatHint:this.props.formatHint,onChange:this.props.onChange},this.props))}render(){return n.createElement("div",{className:`Slider Slider--${this.props.color} ${this.props.className}`,ref:this.containerRef})}}a.defaultProps={color:"blue",defaultValue:.5,formatHint:e=>Math.round(100*e)}},D2Nl:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r("JHWP")),a=r("Iwry"),i=/url\((['"]?)([^'"]+?)\1\)/g;function s(e){var t=[];return e.replace(i,function(e,r,n){return t.push(n),e}),t.filter(function(e){return!a.isDataUrl(e)})}function c(e,t,r,n){var i=r?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;var r=document.implementation.createHTMLDocument(),n=r.createElement("base"),o=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(o),t&&(n.href=t),o.href=e,o.href}(t,r):t;return Promise.resolve(i).then(function(e){return o.default(e,n)}).then(function(e){return a.toDataURL(e,a.getMimeType(t))}).then(function(r){return e.replace(new RegExp("(url\\(['\"]?)("+function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}(t)+")(['\"]?\\))","g"),"$1"+r+"$3")}).then(function(e){return e},function(){return i})}function u(e){return-1!==e.search(i)}t.shouldEmbed=u,t.default=function(e,t,r){return u(e)?Promise.resolve(e).then(s).then(function(n){return n.reduce(function(e,n){return e.then(function(e){return c(e,n,t,r)})},Promise.resolve(e))}):Promise.resolve(e)}},Hx9h:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return s});r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("pemR"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}class s extends n.Component{render(){var e=this.props,t=e.className,r=e.appearance,s=e.wide,c=e.overflow,u=e.size,l=i(e,["className","appearance","wide","overflow","size"]),d=Object(o.classNames)("Button",...Array.isArray(r)?r.map(e=>`Button--${e}`):[`Button--${r}`],`Button--size-${u}`,{"Button--wide":!!s,"Button--overflow":!!c,"Button--disabled":!!e.disabled},t);return n.createElement("button",a({},l,{className:d}),e.children)}}s.defaultProps={appearance:"primary",size:"m",wide:!1,disabled:!1}},Iwry:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o="application/font-woff",a={woff:o,woff2:o,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function i(e){var t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function s(e){var t=i(e).toLowerCase();return a[t]||""}function c(e){return new Promise(function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=r,n.crossOrigin="anonymous",n.src=e})}function u(e){return e.split(/,/)[1]}function l(e,t){var r=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(r.replace("px",""))}function d(){return window.devicePixelRatio||1}t.uuid=(n=0,function(){return n+=1,"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+n}),t.parseExtension=i,t.getMimeType=s,t.delay=function(e){return function(t){return new Promise(function(r){setTimeout(function(){r(t)},e)})}},t.createImage=c,t.isDataUrl=function(e){return-1!==e.search(/^(data:)/)},t.toDataURL=function(e,t){return"data:"+t+";base64,"+e},t.getDataURLContent=u,t.canvasToBlob=function(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):function(e){return new Promise(function(t){for(var r=window.atob(e.toDataURL().split(",")[1]),n=r.length,o=new Uint8Array(n),a=0;a<n;a+=1)o[a]=r.charCodeAt(a);t(new Blob([o],{type:"image/png"}))})}(e)},t.toArray=function(e){for(var t=[],r=0,n=e.length;r<n;r+=1)t.push(e[r]);return t},t.getNodeWidth=function(e){var t=l(e,"border-left-width"),r=l(e,"border-right-width");return e.scrollWidth+t+r},t.getNodeHeight=function(e){var t=l(e,"border-top-width"),r=l(e,"border-bottom-width");return e.scrollHeight+t+r},t.getPixelRatio=d,t.svgToDataURL=function(e){return Promise.resolve().then(function(){return(new XMLSerializer).serializeToString(e)}).then(encodeURIComponent).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})},t.getBlobFromImageURL=function(e){return c(e).then(function(t){var r=t.width,n=t.height,o=document.createElement("canvas"),a=o.getContext("2d"),i=d();return o.width=r*i,o.height=n*i,o.style.width=""+r,o.style.height=""+n,a.scale(i,i),a.drawImage(t,0,0),u(o.toDataURL(s(e)))})}},JHWP:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry"),o=3e4;t.default=function(e,t){return t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),(window.fetch?window.fetch(e).then(function(e){return e.blob()}).then(function(e){return new Promise(function(t,r){var n=new FileReader;n.onloadend=function(){return t(n.result)},n.onerror=r,n.readAsDataURL(e)})}).then(n.getDataURLContent).catch(function(){return new Promise(function(e,t){t()})}):new Promise(function(t,r){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){var o=new FileReader;o.onloadend=function(){t(n.getDataURLContent(o.result))},o.readAsDataURL(a.response)}else r(new Error("Failed to fetch resource: "+e+", status: "+a.status))},a.ontimeout=function(){r(new Error("Timeout of "+o+"ms occured while fetching resource: "+e))},a.responseType="blob",a.timeout=o,a.open("GET",e,!0),a.send()})).catch(function(r){var n="";if(t.imagePlaceholder){var o=t.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}var a="Failed to fetch resource: "+e;return r&&(a="string"==typeof r?r:r.message),a&&console.error(a),n})}},KFTi:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return s});r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("pemR"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function s(e){var t=e.inverted,r=e.size,s=e.className,c=i(e,["inverted","size","className"]),u=Object(o.classNames)("Progress",{"Progress--inverted":t},`Progress--size-${r}`,s);return n.createElement("div",a({className:u},c),n.createElement("div",{className:"Progress__item"}),n.createElement("div",{className:"Progress__item"}),n.createElement("div",{className:"Progress__item"}))}s.defaultProps={inverted:!1,size:"s"}},OmAd:function(e,t,r){"use strict";r.r(t);var n,o=r("q1tI"),a=r("i8i4"),i=r("fjjh"),s=r("jE6c"),c=r("EasH"),u=r("T/g7"),l=r("3oLO"),d=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),f=r("r7nW").default,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=window.innerHeight-100,r=e/1.78;return o.createElement(f,{disableBodyScroll:!0,onClose:t.onClose},o.createElement(i.default,{context:"story",photoUrl:t.props.photoUrl,artboardWidth:r,artboardHeight:e,save:t.save,close:t.onClose,attachment:t.props.attachment,stickers:t.props.stickers}))},t.save=function(e,r,n){void 0===n&&(n={}),l.ajax.post("al_stories.php",{act:"get_upload_url",attachment:JSON.stringify(t.props.attachment),analytics:n.analytics,hash:n.hash,entry_point:t.props.entrypoint,ref:window.cur.module},{onDone:function(n){t.sendToServer(e,n,r)},onFail:function(e){var t=e||Object(u.getLang)("global_error");return window.showFastBox({title:Object(u.getLang)("global_error")},t,Object(u.getLang)("global_close"),function(){r(),window.curBox().hide()}),!0}})},t.sendToServer=function(e,r,n){var o=new FormData,a=encodeURIComponent("edited_"+Object(s.irand)(0,99999)+".jpg");o.append("file0",e,a),fetch(r,{method:"POST",body:o}).then(function(){t.onClose(!0),n()}).catch(function(e){console.error(e)})},t.onClose=function(e,r){r?t.props.onClose():e?(window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose()):t.box?(t.box.hide(),delete t.box):t.box=Object(c.showFastBox)({title:Object(u.getLang)("photos_pe_are_you_sure_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},Object(u.getLang)("photos_pe_are_you_sure_close_text"),Object(u.getLang)("box_yes"),function(){t.props.onClose(),t.box.hide()},Object(u.getLang)("box_no"))},t}return d(t,e),t}(o.Component),h=r("ufMw");r.d(t,"StoryPublisher",function(){return y});var y={init:function(e){var t=this;window.stManager.add([window.jsc("web/stories_publisher.js"),"photo_editor.css"]).then(function(){var r=e?e.photoUrl:"",n=e?e.stickers:null,i=e?e.entrypoint:"",s=e?e.attachment:null;window.cur.storyPublishContext=!0,"story_repost"===i?Object(h.sendStat)(h.EVENTS.ADD_STORY_FROM_SHARING):Object(h.sendStat)(h.EVENTS.ADD_STORY);var c=document.querySelector(".StoriesPublisher");c||((c=document.createElement("div")).classList.add("StoriesPublisher"),document.body.append(c)),a.render(o.createElement(p,{entrypoint:i,onClose:t.destroy,photoUrl:r,attachment:s,stickers:n}),c)}).catch(function(e){console.error(e)})},destroy:function(){var e=document.querySelector(".StoriesPublisher");e&&a.unmountComponentAtNode(e)}}},PjZB:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return o});r("rGqo"),r("a1Th"),r("Btvt");var n=r("q1tI");r("17x9");class o extends n.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var r=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(r=>r+":"+t[e][r]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${r}} @keyframes ${e} {${r}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,r=e.color,o=e.size,a=e.duration,i=e.strokeWidth,s=this.id,c=this.offset,u=this.animation;return n.createElement("div",{className:"Spinner",style:t},n.createElement("svg",{className:"Spinner__svg",width:o,height:o,viewBox:`0 0 ${o} ${o}`,xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{style:{width:o,height:o,transformOrigin:.5*o+"px "+.5*o+"px"}},n.createElement("style",{dangerouslySetInnerHTML:{__html:u}}),n.createElement("circle",{className:"Spinner__path",fill:"none",stroke:r,strokeDasharray:c,strokeDashoffset:c,strokeWidth:i,style:{animationName:"dash"+s,animationTimingFunction:"ease-in-out",animationDuration:a+"s",animationIterationCount:"infinite"},cx:.5*o,cy:.5*o,r:.5*o-.5*i}))))}}o.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4}},QLaP:function(e,t,r){"use strict";e.exports=function(e,t,r,n,o,a,i,s){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[r,n,o,a,i,s],l=0;(c=new Error(t.replace(/%s/g,function(){return u[l++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}}},SLVX:function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.r(t),r.d(t,"default",function(){return n})},"T/g7":function(e,t,r){"use strict";r.r(t),r.d(t,"getLang",function(){return i});var n=r("nAFc"),o=r("4+be"),a={};function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,i="number"==typeof t,s=e+(t||i?".raw":"");if(void 0===a[s]){var c=t||i?Object(o.getLang)(e,"raw"):Object(o.getLang)(e);"string"==typeof c?a[s]=Object(n.decodeHTMLEntities)(c):Array.isArray(c)&&(a[s]=c.map(n.decodeHTMLEntities))}if(i){var u=t;return Object(o.langNumeric)(u,a[s],r)}return a[s]||""}t.default={getLang:i}},TBLV:function(e,t,r){"use strict";r.r(t);r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("pemR"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=e=>{var t=e.className,r=e.children,s=i(e,["className","children"]),c=Object(o.classNames)("Radio",t,{"Radio--disabled":e.disabled});return n.createElement("label",{className:c},n.createElement("input",a({className:"Radio__input Radio__visuallyHidden",type:"radio"},s)),n.createElement("span",{className:"Radio__control"}),Boolean(r)&&n.createElement("span",{className:"Radio__text"},r))};s.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=s},TOwV:function(e,t,r){"use strict";e.exports=r("qT12")},UlUB:function(e,t,r){"use strict";function n(e,t){var r,n,o=!1;return function a(){if(o)return r=arguments,void(n=this);e.apply(this,arguments),o=!0,setTimeout(function(){o=!1,r&&(a.apply(n,r),r=n=null)},t)}}r.r(t),r.d(t,"default",function(){return n})},WbBG:function(e,t,r){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},WfVW:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("JHWP")),i=n(r("D2Nl"));function s(e,t){return e instanceof Element?Promise.resolve(e).then(function(e){return function(e,t){var r=e.style.getPropertyValue("background");return r?Promise.resolve(r).then(function(e){return i.default(e,null,t)}).then(function(t){return e.style.setProperty("background",t,e.style.getPropertyPriority("background")),e}):Promise.resolve(e)}(e,t)}).then(function(e){return function(e,t){return e instanceof HTMLImageElement&&!o.isDataUrl(e.src)?Promise.resolve(e.src).then(function(e){return a.default(e,t)}).then(function(t){return o.toDataURL(t,o.getMimeType(e.src))}).then(function(t){return new Promise(function(r,n){e.onload=r,e.onerror=n,e.src=t})}).then(function(){return e},function(){return e}):Promise.resolve(e)}(e,t)}).then(function(e){return function(e,t){var r=o.toArray(e.childNodes).map(function(e){return s(e,t)});return Promise.all(r).then(function(){return e})}(e,t)}):Promise.resolve(e)}t.default=s},XpgC:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return l});r("91GP");var n=r("q1tI"),o=r("i8i4"),a=(r("17x9"),r("pemR")),i=r("clTp");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var c=()=>"undefined"!=typeof window,u=e=>{var t=e.position,r=e.align,n=e.text,o=e.rect,a=e.marginTop,i=e.marginLeft,s=e.maxWidth,c=e.appearance,u=o.left,l=o.top;switch(t){case"t":u+=.5*o.width;break;case"r":u+=o.width,l+=.5*o.height;break;case"b":u+=.5*o.width,l+=o.height;break;case"l":l+=.5*o.height}return{tooltip:{position:t,align:r,text:n,x:u=Math.round(u+i),y:l=Math.round(l+a),maxWidth:s,appearance:c}}};class l extends n.Component{constructor(e){super(e),this.onMouseEnter=e=>{if(this.state.el){var t=this.props,r=t.text,n=t.position,o=t.align,a=t.marginTop,s=t.marginLeft,c=t.maxWidth,u=t.appearance,l=Object(i.default)(this.state.el);this.update({text:r,position:n,align:o,rect:l,marginTop:a,marginLeft:s,maxWidth:c,appearance:u})}},this.onMouseLeave=e=>this.update(),this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.tooltip&&this.setState({tooltip:void 0})},this.renderTooltip=()=>{if(!this.state.tooltip)return null;var e=this.state.tooltip,t=e.x,r=e.y,o=e.position,i=e.align,s=e.text,c=e.removed,u=e.maxWidth,l=e.appearance,d=Object(a.classNames)("Tooltip",`Tooltip--${o}`,`Tooltip--${l}`,{"Tooltip--removed":!!c,[`Tooltip--align-${i}`]:"t"===o||"b"===o});return n.createElement("div",{className:d,style:{top:r,left:t},onTransitionEnd:this.onTransitionEnd},n.createElement("div",{className:"Tooltip__in",style:{maxWidth:u},dangerouslySetInnerHTML:{__html:s}}))},this.state={}}componentDidMount(){var e=o.findDOMNode(this);this.setState({el:e}),e.addEventListener("mouseenter",this.onMouseEnter),e.addEventListener("mouseleave",this.onMouseLeave)}componentWillUnmount(){this.state.el.removeEventListener("mouseenter",this.onMouseEnter),this.state.el.removeEventListener("mouseleave",this.onMouseLeave)}static getDerivedStateFromProps(e,t){return t.tooltip&&["text","position","align","maxWidth","appearance"].some(r=>e[r]!==t.tooltip[r])?u(s({},e,{rect:Object(i.default)(t.el)})):null}update(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(u(e))}render(){var e=this.renderTooltip();return e?(!this.defaultNode&&c()&&(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),n.createElement(n.Fragment,null,this.props.children,o.createPortal(e,this.defaultNode))):this.props.children}}l.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"}},Ya8i:function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("D2Nl"));function i(e){if(void 0===e)return[];var t=e,r=[],n=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)","gi");t=t.replace(n,"");for(var o,a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");null!==(o=a.exec(t));)r.push(o[0]);t=t.replace(a,"");for(var i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");null!==(o=i.exec(t));)r.push(o[0]);return r}function s(e,t){return fetch(e).then(function(t){return{url:e,cssText:t.text()}},function(e){console.log("ERROR FETCHING CSS: ",e.toString())})}function c(e){return e.cssText.then(function(t){var r=t,n=(r.match(/url\([^)]+\)/g)||[]).map(function(t){var n=t.replace(/url\(([^]+)\)/g,"$1");if(!n.startsWith("https://")){var o=e.url;n=new URL(n,o).href}return new Promise(function(e,o){fetch(n).then(function(e){return e.blob()}).then(function(n){var o=new FileReader;o.addEventListener("load",function(n){r=r.replace(t,"url("+o.result+")"),e([t,o.result])}),o.readAsDataURL(n)}).catch(o)})});return Promise.all(n).then(function(){return r})})}function u(e){var t=[],r=[];return e.forEach(function(t){if("cssRules"in t)try{o.toArray(t.cssRules).forEach(function(e){e.type===CSSRule.IMPORT_RULE&&r.push(s(e.href).then(c).then(function(e){i(e).forEach(function(e){t.insertRule(e,t.cssRules.length)})}).catch(function(e){console.log("Error loading remote css",e.toString())}))})}catch(o){var n=e.find(function(e){return null===e.href})||document.styleSheets[0];null!=t.href&&r.push(s(t.href).then(c).then(function(e){i(e).forEach(function(e){n.insertRule(e,t.cssRules.length)})}).catch(function(e){console.log("Error loading remote stylesheet",e.toString())})),console.log("Error inlining remote css file",o.toString())}}),Promise.all(r).then(function(){return e.forEach(function(e){if("cssRules"in e)try{o.toArray(e.cssRules).forEach(function(e){t.push(e)})}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}}),t})}function l(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return a.shouldEmbed(e.style.getPropertyValue("src"))})}function d(e){return new Promise(function(t,r){e.ownerDocument||r(new Error("Provided element is not within a Document")),t(o.toArray(e.ownerDocument.styleSheets))}).then(u).then(l)}t.parseWebFontRules=d,t.default=function(e,t){return d(e).then(function(e){return Promise.all(e.map(function(e){var r=e.parentStyleSheet?e.parentStyleSheet.href:null;return a.default(e.cssText,r,t)}))}).then(function(e){return e.join("\n")}).then(function(t){var r=document.createElement("style"),n=document.createTextNode(t);return r.appendChild(n),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e})}},bCCX:function(e,t,r){"use strict";r.r(t),function(e,n){var o,a=r("SLVX");o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:n;var i=Object(a.default)(o);t.default=i}.call(this,r("yLpj"),r("3UD+")(e))},clTp:function(e,t,r){"use strict";function n(e){var t=e.getBoundingClientRect(),r=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||r.scrollTop,a=window.pageXOffset||n.scrollLeft||r.scrollLeft,i=n.clientTop||r.clientTop||0,s=n.clientLeft||r.clientLeft||0;return{top:Math.round(t.top+o-i),left:Math.round(t.left+a-s),width:e.offsetWidth,height:e.offsetHeight}}r.r(t),r.d(t,"default",function(){return n})},e9h0:function(e,t,r){"use strict";r.r(t);var n=r("OmAd");window.StoriesPublisher=n.StoryPublisher;try{window.stManager.done(window.jsc("web/stories_publisher.js"))}catch(e){}},fjjh:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("/MKj"),a=r("ANjH"),i=r("/TnQ"),s=r("sINF"),c=r("xYVc"),u=function(){return(u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:c.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0},d=function(e,t){switch(void 0===e&&(e=l),t.type){case"SET_DATA_LOADED":return u(u({},e),{isDataLoaded:!0});case"SET_SHOW_DROP_BOX":return u(u({},e),{isShowDropBox:t.value});case"SET_SAVE_LOADING":return u(u({},e),{isSaveLoading:t.value});case"SET_CURRENT_TAB":return u(u({},e),{currentMode:t.value});case"SET_CURRENT_STICKER_PACK_INDEX":return u(u({},e),{currentStickerPackIndex:t.value});case"SET_HEADER_SCROLL_POSITION":return u(u({},e),{stickerHeaderScrollPosition:t.value});default:return e}},f=function(){return(f=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},p={color:c.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:c.default.FONTS[0]},h=function(e,t){switch(void 0===e&&(e=p),t.type){case"SET_SETTING_COLOR":return f(f({},e),{color:t.color});case"SET_SETTING_BRUSH_WIDTH":return f(f({},e),{brushWidth:t.brushWidth});case"SET_SETTING_BRUSH_OPACITY":return f(f({},e),{brushOpacity:t.brushOpacity});case"SET_SETTING_FONT_SIZE":return f(f({},e),{fontSize:t.fontSize});case"SET_SETTING_FONT_FAMILY":return f(f({},e),{fontStyle:t.fontStyle});default:return e}},y=function(){return(y=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},m=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},v={currentIndex:null,items:[]},g=function(e,t){switch(void 0===e&&(e=v),t.type){case"SET_CURRENT_LAYER":return y(y({},e),{currentIndex:t.index});case"ADD_LAYER_STICKER":case"ADD_LAYER_TEXT":case"ADD_LAYER_IMAGE":return y(y({},e),{items:m(e.items,[t.payload])});case"UPDATE_LAYER":return y(y({},e),{items:e.items.map(function(r,n){return e.currentIndex===n?y(y({},r),t.payload):r})});case"DELETE_LAYER":return{currentIndex:null,items:e.items.filter(function(e,r){return r!==t.index})};default:return e}},_=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},E=function(e,t){switch(void 0===e&&(e=[]),t.type){case"ADD_VECTOR":return _(e,[t.payload]);case"UNDO_DRAWING":return e.filter(function(t,r){return r!==e.length-1});default:return e}},b=function(){return(b=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},w={currentBackgroundType:c.default.BACKGROUND_MODES.PHOTO,currentPhotoUrl:null,currentBackgroundId:1},S=function(e,t){switch(void 0===e&&(e=w),t.type){case"SET_CURRENT_BACKGROUND_TYPE":return b(b({},e),{currentBackgroundType:t.value});case"SET_CURRENT_PHOTO_URL":return b(b({},e),{currentPhotoUrl:t.value});case"SET_CURRENT_BACKGROUND_ID":return b(b({},e),{currentBackgroundId:t.value});default:return e}},O=function(){return(O=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},T=function(e,t){switch(void 0===e&&(e={}),t.type){case"SET_DATA":return O(O({},e),t.payload);default:return e}},P=Object(a.combineReducers)({ui:d,settings:h,layers:g,drawings:E,background:S,data:T}),C=r("mYgU"),x=r.n(C),L=r("ufMw"),N=r("nAFc"),k=r("jE6c"),R=function(e){return{type:"SET_CURRENT_LAYER",index:e}},D=function(e,t,r){return void 0===r&&(r=!0),function(n,o){var a=o().layers.items;n({type:e,payload:t}),r&&n(R(a.length))}},I=function(e,t){return function(r,n){var o,a=n(),i=a.data,s=a.settings,u=i.artboardWidth/2,l=i.artboardHeight/2,d=Object(N.decodeHTMLEntities)(i.placeholders[Object(k.irand)(0,i.placeholders.length-1)]),f=0,p=!1,h=s.fontStyle,y=s.color,m=s.fontSize;t&&(u=void 0!==t.x?t.x:u,l=void 0!==t.y?t.y:l,d=void 0!==t.text?t.text:d,f=void 0!==t.rotate?t.rotate:f,p=void 0!==t.isEdit?t.isEdit:p,h=void 0!==t.style?t.style:h,y=void 0!==t.color?t.color:y,m=void 0!==t.fontSize?t.fontSize:m,o=t.initialFontSize),Object(L.sendStat)(L.EVENTS.ADD_TEXT),e&&r(F(c.default.TABS.TEXT)),r(D("ADD_LAYER_TEXT",{type:c.default.LAYER_TYPES.TEXT,text:d,x:u,y:l,rotate:f,isFixed:!1,isEdit:p,fontSize:m,initialFontSize:o,fontStyle:h,color:y,scale:1},e))}},j=function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"UPDATE_LAYER",payload:e})}},A=function(){return function(e,t){var r=t().layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&(a.type===c.default.LAYER_TYPES.STICKER?Object(L.sendStat)(L.EVENTS.DELETE_STICKER):a.type===c.default.LAYER_TYPES.TEXT&&Object(L.sendStat)(L.EVENTS.DELETE_TEXT),e(B(!1)),e({type:"DELETE_LAYER",index:n}))}}},M=function(){return function(e,t){var r=t().layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&a.type===c.default.LAYER_TYPES.TEXT&&(o[n].text.trim()?e(j({isEdit:!1})):e(A()))}}},B=function(e){return{type:"SET_SHOW_DROP_BOX",value:e}},F=function(e){return function(t,r){var n=r().layers,o=n.items,a=n.currentIndex;null!==a&&(o[a].type===c.default.LAYER_TYPES.TEXT&&t(M()),e===c.default.TABS.PAINT&&t(R(null))),t({type:"SET_CURRENT_TAB",value:e})}},U=function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(j({color:e})),t({type:"SET_SETTING_COLOR",color:e})}},H=function(){return Object(L.sendStat)(L.EVENTS.CANCEL_GRAFFITI),{type:"UNDO_DRAWING"}},Y=r("i8i4");function W(e){return new Promise(function(t,r){var n=new Image;n.crossOrigin="Anonymous",n.onerror=function(){r(new Error("Failed to load image's URL: "+e))},n.onload=function(){t(n)},n.src=e})}function K(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0};var r=t.getBoundingClientRect(),n=r.left,o=r.top;return{x:e.clientX-n,y:e.clientY-o,xOrigin:n,yOrigin:o}}function G(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function X(){return new Promise(function(e,t){var r=document.createElement("input");r.value="",r.type="file",r.accept="image/*",r.onchange=function(n){var o=n.target;if(r.remove(),!o)return t();if(!o.files)return t();var a=o.files[0],i=URL.createObjectURL(a);W(i).then(function(){(function(e){return new Promise(function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,n=new DataView(r.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var o=n.byteLength,a=2;a<o;){if(n.getUint16(a+2,!1)<=8)return t(-1);var i=n.getUint16(a,!1);if(a+=2,65505==i){if(1165519206!=n.getUint32(a+=2,!1))return t(-1);var s=18761==n.getUint16(a+=6,!1);a+=n.getUint32(a+4,s);var c=n.getUint16(a,s);a+=2;for(var u=0;u<c;u++)if(274==n.getUint16(a+12*u,s))return t(n.getUint16(a+12*u+8,s))}else{if(65280!=(65280&i))break;a+=n.getUint16(a,!1)}}return t(-1)}},r.readAsArrayBuffer(e)})})(a).then(function(r){-1===r||-2===r||1===r?e(i):function(e,t){return new Promise(function(r,n){var o=new Image;o.onload=function(){var e=o.width,a=o.height,i=document.createElement("canvas"),s=i.getContext("2d");if(!s)return n();switch(4<t&&t<9?(i.width=a,i.height=e):(i.width=e,i.height=a),t){case 2:s.transform(-1,0,0,1,e,0);break;case 3:s.transform(-1,0,0,-1,e,a);break;case 4:s.transform(1,0,0,-1,0,a);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,a,0);break;case 7:s.transform(0,-1,-1,0,a,e);break;case 8:s.transform(0,-1,1,0,0,e)}s.drawImage(o,0,0),r(i.toDataURL())},o.src=e})}(i,r).then(function(t){e(t)}).catch(function(){t()})}).catch(function(){t()})}).catch(function(){t()})},document.body.appendChild(r),r.click()})}var z,V=(z=function(e,t){return(z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}z(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),q=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){return r.props.drawings.length!==e.drawings.length&&r.renderDrawings(e.drawings),!1},r.renderDrawings=function(e){var t=r.canvas.current;if(t){var n=t.getContext("2d");if(n){var o=r.props.data.originalHeight/r.props.height;n.clearRect(0,0,t.width,t.height),n.lineCap="round",n.lineJoin="round",e.forEach(function(e){n.lineWidth=e.width*c.default.BRUSH_WIDTH_COEFFICIENT*o,n.strokeStyle=G(e.color,e.opacity),n.beginPath(),n.moveTo(e.path[0][0]*o,e.path[0][1]*o),e.path.forEach(function(e){n.lineTo(e[0]*o,e[1]*o)}),n.stroke()})}}},r.drawStart=function(e){if(r.props.ui.currentMode===c.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=K(e.nativeEvent,r.canvas.current),n=t.x,o=t.y;r.currentDrawing=[[n,o]];var a=r.props.settings;r.props.addDrawing({color:a.color,width:a.brushWidth,opacity:a.brushOpacity,path:r.currentDrawing}),r.renderDrawings(r.props.drawings)}},r.drawProcess=function(e){var t=K(e,r.canvas.current),n=t.x,o=t.y;r.currentDrawing.push([n,o]),r.renderDrawings(r.props.drawings)},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvasDoubleClick=function(){r.props.ui.currentMode!==c.default.TABS.PAINT&&r.props.addLayerText(!0,{isEdit:!0})},r.canvas=n.createRef(),r.currentDrawing=[],r}return V(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,o=e.height;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--draw",onDoubleClick:this.canvasDoubleClick,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:o}})},t}(n.Component),$=Object(o.connect)(function(e){return{ui:e.ui,settings:e.settings,drawings:e.drawings,data:e.data}},function(e){return{addDrawing:function(t){return e(function(e){return Object(L.sendStat)(L.EVENTS.ADD_GRAFFITI),{type:"ADD_VECTOR",payload:e}}(t))},addLayerText:function(t,r){return e(I(t,r))}}})(q),Z=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),J=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Q=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props.background;return t.currentBackgroundId===e.background.currentBackgroundId&&t.currentBackgroundType===e.background.currentBackgroundType&&t.currentPhotoUrl===e.background.currentPhotoUrl||r.renderImage(e.background),!1},r.getBackgroundById=function(e){var t=r.props.data.backgrounds,n=t.gradients,o=t.emojies;return J(n,o).filter(function(t){return t.id===e})[0]},r.getCurrentImageUrl=function(e){var t,n=e||r.props.background,o=n.currentBackgroundType,a=n.currentPhotoUrl,i=n.currentBackgroundId;o===c.default.BACKGROUND_MODES.PHOTO?t=a:t=r.getBackgroundById(i).url;return t},r.renderImage=function(e){var t=r.canvas.current;if(t){var n=r.getCurrentImageUrl(e);n&&W(n).then(function(e){var r=t.getContext("2d");if(r){var n=+(e.height/e.width).toFixed(2),o=t.width,a=t.height;if(e.width<t.width&&e.height<t.height?(o=e.width,a=e.height):a=t.width*n,r.save(),r.clearRect(0,0,t.width,t.height),r.filter="blur(135px)",r.drawImage(e,0,0,t.width,t.height),r.restore(),"none"!==r.filter){var i=function(e){var t,r={r:0,g:0,b:0};if(!e)return r;try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return r}for(var n=-4,o=0;(n+=20)<t.data.length;)++o,r.r+=t.data[n],r.g+=t.data[n+1],r.b+=t.data[n+2];return r.r=~~(r.r/o),r.g=~~(r.g/o),r.b=~~(r.b/o),r}(r);r.fillStyle="rgb("+i.r+", "+i.g+", "+i.b+")",r.fillRect(0,0,t.width,t.height)}r.drawImage(e,t.width/2-o/2,t.height/2-a/2,o,a)}}).catch(function(e){console.error(e)})}},r.canvas=n.createRef(),r}return Z(t,e),t.prototype.componentDidMount=function(){this.renderImage()},t.prototype.render=function(){var e=this.props.data;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:e.originalWidth,height:e.originalHeight,style:{width:this.props.width,height:this.props.height}})},t}(n.Component),ee=Object(o.connect)(function(e){return{data:e.data,background:e.background}})(Q),te=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.layer=t.props.layer,t.layer.type===c.default.LAYER_TYPES.TEXT){var n=e.target.closest(".EditorLayer__inner");if(!n)return;t.width=n.offsetWidth,t.height=n.offsetHeight}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=K(e,document.querySelector(".EditorCanvas__canvas--draw")),n=r.x,o=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var a={x:n-t.layer.x,y:o-t.layer.y},i=180*(Math.atan2(a.y,a.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,s=Math.max(c.default.LAYER_MIN_SIZE,Math.sqrt(a.x*a.x+a.y*a.y))/t.distanceToZero,u=Math.floor(t.width*s),l=Math.floor(t.height*s);t.layer.type===c.default.LAYER_TYPES.TEXT?t.props.updateLayer({fontSize:t.layer.fontSize*s,rotate:i}):t.props.updateLayer({width:u,height:l,rotate:i})}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return te(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"EditorLayerSelection"},n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}}))},t}(n.Component),ne=r("pemR"),oe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderLayerSticker=function(e,r,o){var a=t.props.getStickerUrlById(e.id,c.default.STICKER_LARGE);return n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width,height:e.height,backgroundImage:"url('"+a+"')"}},t.props.currentIndex===r&&n.createElement(re,{layer:e,updateLayer:t.props.updateLayer})))},t.renderLayerImage=function(e,r,o){return n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width,height:e.height,backgroundImage:"url('"+e.url+"')"}},t.props.currentIndex===r&&n.createElement(re,{layer:e,updateLayer:t.props.updateLayer})))},t.renderLayerText=function(e,r,o){var a=Math.max(2,e.fontSize*e.scale*c.default.FONT_SIZE_COEFFICIENT);o+=" PhotoEditorFontStyle--"+e.fontStyle;var i={fontSize:a,color:e.color};return t.props.currentIndex===r&&e.isEdit?null:n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:i,onDoubleClick:t.handleDoubleClick},n.createElement("div",null,Object(N.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))),t.props.currentIndex===r&&n.createElement(re,{layer:e,updateLayer:t.props.updateLayer})))},t.handleDoubleClick=function(){t.props.updateLayer({isEdit:!0})},t}return oe(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,n=e.index,o=null,a=Object(ne.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===n,"EditorLayer--drag":t.isFixed,"EditorLayer--hide":t.isHide});switch(t.type){case c.default.LAYER_TYPES.STICKER:o=this.renderLayerSticker(t,n,a);break;case c.default.LAYER_TYPES.TEXT:o=this.renderLayerText(t,n,a);break;case c.default.LAYER_TYPES.IMAGE:o=this.renderLayerImage(t,n,a)}return t.isFixed?Y.createPortal(o,document.body):o},t}(n.Component),ie=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ie(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,o=t.currentIndex,a=Object(ne.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":this.props.currentMode===c.default.TABS.PAINT});return n.createElement("div",{className:a,id:"EditorCanvas__layers"},r.map(function(t,r){return n.createElement(ae,{key:r,index:r,currentIndex:o,layer:t,updateLayer:e.props.updateLayer,getStickerUrlById:e.props.getStickerUrlById})}))},t}(n.Component),ce=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ue=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=.5*c.default.FONT_SIZE_COEFFICIENT;return e.initialFontSize&&(t=e.initialFontSize*c.default.FONT_SIZE_COEFFICIENT),n.createElement("div",{className:"EditorText"},n.createElement("div",{className:"EditorText__inner"},n.createElement("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:Object(N.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}})))},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},function(){r.setState({height:e.scrollHeight})}),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var n=r.scrollWidth,o=0,a=-1;o<t.length;o++){var i=t.charAt(o);if(" "!=i&&"-"!=i&&"+"!=i||(a=o),r.value+=i,r.scrollWidth>n){var s="";if(a>=0){for(var c=a+1;c<o;c++)s+=t.charAt(c);a=-1}s+=i,r.value=r.value.substr(0,r.value.length-s.length),r.value+="\n\v"+s}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=n.createRef(),Object(L.sendStat)(L.EVENTS.EDIT_TEXT),r}return ce(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontStyle!==this.props.layer.fontStyle&&this.onChange()},t}(n.Component),le=r("4+be"),de=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),fe=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},pe=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,o=t.currentIndex,a=t.items,i=null!==o&&a[o],s=i&&i.type===c.default.LAYER_TYPES.TEXT&&i.isEdit,u=i&&i.type===c.default.LAYER_TYPES.STICKER&&i.isHide,l="";return i&&(i.type===c.default.LAYER_TYPES.STICKER?l=Object(le.getLang)("photos_pe_delete_sticker"):i.type===c.default.LAYER_TYPES.TEXT&&(l=Object(le.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==c.default.BACKGROUND_MODES.BACKGROUND||i||(e=!0),n.createElement("div",{className:"StatusPanel"},e?r.renderBackgrounds():n.createElement("div",{className:"StatusPanel__inner"},r.renderLeftBlock(),n.createElement("div",null,i&&!s&&!u&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.deleteLayer},l),i&&s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.closeTextEditor},Object(le.getLang)("photos_pe_save_action")))))},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?n.createElement("div",null,e&&e.edited&&e.canEdit&&n.createElement("a",{className:"StatusPanel__link",onClick:e.restore},Object(le.getLang)("photos_filtered_restore")),e&&!e.canEdit&&n.createElement("span",{className:"StatusPanel__info"},Object(le.getLang)("photos_will_be_saved_to_pe_album"))):n.createElement("div",null,r.props.currentBackgroundType===c.default.BACKGROUND_MODES.PHOTO&&n.createElement("a",{className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},Object(le.getLang)("photos_pe_change_photo")))},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds||{},o=t.gradients,a=void 0===o?{}:o,i=t.emojies,s=void 0===i?{}:i,c=r.scrollElement.current,u=c?e+c.offsetWidth:0,l=!!e,d=!c||!!(c.scrollWidth-u);return n.createElement("div",{className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},n.createElement("div",{className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},fe(a,s).map(function(e){var t=e.id,o=e.preview;return n.createElement("a",{className:Object(ne.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),key:t,style:{backgroundImage:"url("+o+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}})})),l&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})),d&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})))},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var n=r.scrollElement.current;if(n){var o=r.state.scrollBlockPosition,a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:i})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth/2;e&&(n=-n),r.setPosition(n,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r}return de(t,e),t}(n.Component),he=Object(o.connect)(function(e){return{context:e.data.context,layers:e.layers,addons:e.data.addons}},function(e){return{deleteLayer:function(){return e(A())},closeTextEditor:function(){return e(M())}}})(pe),ye=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===c.default.BACKGROUND_MODES.PHOTO?Object(L.sendStat)(L.EVENTS.CLICK_TO_CAMERA_ICON):e===c.default.BACKGROUND_MODES.BACKGROUND&&Object(L.sendStat)(L.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return ye(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"SwitchMode"},Object.values(c.default.BACKGROUND_MODES).map(function(t){var r=Object(ne.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current});return n.createElement("span",{key:t,className:r,onClick:function(){return e.setMode(t)}})}))},t}(n.Component),ve=r("T/g7"),ge=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_e=r("XpgC").default,Ee=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?Y.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,o=e.background,a=e.data,i=a.addons,s=a.artboardWidth,u=a.artboardHeight,l=a.attachment,d=t.props.layers,f=d.currentIndex,p=d.items,h=null!==f&&p[f],y=h&&h.type===c.default.LAYER_TYPES.TEXT&&h.isEdit,m=t.props.ui.isDataLoaded&&t.props.data.context===c.default.CONTEXT_TYPES.STORY,v=u;i&&i.photoHeight&&(v=i.photoHeight);var g=0;return i&&i.photoOffsetTop&&(g=i.photoOffsetTop),n.createElement(n.Fragment,null,n.createElement("div",{style:{width:s,height:v,marginTop:g},className:"EditorCanvas"},n.createElement(se,{updateLayer:t.props.updateLayer,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r}),y&&h?n.createElement(ue,{layer:h,onChange:t.onChangeText}):m&&n.createElement(n.Fragment,null,!!l&&n.createElement(_e,{text:Object(ve.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},n.createElement("span",{className:"EditorCanvas__postIcon"})),n.createElement(me,{current:o.currentBackgroundType,setMode:t.setMode})),t.props.ui.isDataLoaded&&n.createElement($,{width:s,height:v}),t.props.ui.isDataLoaded&&n.createElement(ee,{width:s,height:v})),t.props.ui.isDataLoaded&&n.createElement(he,{currentBackgroundId:o.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:o.currentBackgroundType,uploadPhoto:t.uploadPhoto,backgrounds:t.props.data.backgrounds}))},t.onChangeText=function(e){t.props.updateLayer({text:e})},t.setMode=function(e){var r=t.props.background,n=r.currentBackgroundType,o=r.currentPhotoUrl;t.props.setCurrentLayer(null),e===c.default.BACKGROUND_MODES.PHOTO&&!o||n===c.default.BACKGROUND_MODES.PHOTO&&n===e?t.uploadPhoto(function(){t.props.setBackgroundType(e)}):t.props.setBackgroundType(e)},t.uploadPhoto=function(e){X().then(function(r){e&&e(),t.props.setCurrentPhotoUrl(r)}).catch(function(){window.showFastBox({title:Object(ve.getLang)("global_error")},Object(ve.getLang)("stories_create_image_incorrect"))})},t}return ge(t,e),t}(n.Component),be=Object(o.connect)(function(e){return{ui:e.ui,settings:e.settings,layers:e.layers,drawings:e.drawings,background:e.background,data:e.data}},function(e){return{setCurrentBackgroundId:function(t){return e(function(e){return Object(L.sendStat)(L.EVENTS.SELECT_BACKGROUND),{type:"SET_CURRENT_BACKGROUND_ID",value:e}}(t))},updateLayer:function(t){return e(j(t))},setCurrentLayer:function(t){return e(R(t))},setBackgroundType:function(t){return e({type:"SET_CURRENT_BACKGROUND_TYPE",value:t})},setCurrentPhotoUrl:function(t){return e(function(e){return{type:"SET_CURRENT_PHOTO_URL",value:e}}(t))}}})(Ee),we=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return we(t,e),t.prototype.render=function(){var e=this.props,t=e.current,r=e.change;return n.createElement("div",{className:"EditorTabs"},n.createElement("div",{className:"EditorTabs__header"},n.Children.map(this.props.children,function(e){var o=Object(ne.classNames)("EditorTabs__item","EditorTabs__item--"+e.props["data-mode"],{"EditorTabs__item--current":t===e.props["data-mode"]});return n.createElement("div",{className:o,key:e.props["data-mode"],onClick:function(){return r(e.props["data-mode"])}})})),n.createElement("div",{className:"EditorTabs__content"},n.Children.map(this.props.children,function(e){var r={className:Object(ne.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":t===e.props["data-mode"]})};return n.cloneElement(e,r)})))},t}(n.Component),Oe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Te=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return Oe(t,e),t.prototype.render=function(){var e=this,t=Object(ne.classNames)("DropBox__inner",{"DropBox__inner--hover":this.state.onHover});return n.createElement("div",{className:"DropBox"},n.createElement("div",{className:t,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},n.createElement("div",{className:"DropBox__icon"},this.renderIcon()),n.createElement("span",{dangerouslySetInnerHTML:{__html:Object(ve.getLang)("photos_pe_drag_to_remove")}})))},t.prototype.renderIcon=function(){return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50px",height:"50px",viewBox:"0 0 50 50"},n.createElement("path",{d:"M15 19H35V37C35 38.1 34.1 39 33 39H17C15.9 39 15 38.1 15 37V19Z",fill:"white"}),n.createElement("path",{d:"M37 15C37 13.9 36.1 13 35 13H28.4C28.4 11.9 27.5 11 26.4 11H23.6C22.5 11 21.6 11.9 21.6 13H15C13.9 13 13 13.9 13 15C13 15 13 13.5 13 15V17H37V15C37 15 37 13.4 37 15Z",fill:"white",className:"cap"}))},t}(n.Component),Pe=r("t7n3"),Ce=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xe=r("vRp6").default,Le=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.setState({})},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e=r.props,t=e.stickers,o=e.stickerMouseDown,a=r.props.ui,i=a.stickerHeaderScrollPosition,s=a.currentStickerPackIndex,u=r.scrollElement.current,l=!!i,d=!1,f=0;u&&(f=i+u.offsetWidth,d=!!(u.scrollWidth-f));var p=t[s]?t[s].items:[];r.needReset&&(r.needReset=!1,p=[],r.setState({}));for(var h=[],y=0,m=p.length;y<m;y+=3)h.push(p.slice(y,y+3));return n.createElement("div",{className:"StickersPanel"},r.props.ui.isShowDropBox&&n.createElement(Te,{onDelete:r.props.deleteLayer}),n.createElement("div",{className:"StickersPanel__header"},n.createElement("div",{className:"StickersPanel__scroll",style:{transform:"translateX(-"+i+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},t.map(function(e,t){var o=e.id,a=r.getTabPreviewUrl(t);if(!a)return null;var i=!Object(Pe.inArray)(o,["recent","editor"]),c=Object(ne.classNames)("StickersPanel__tab",{"StickersPanel__tab--selected":t===s,"StickersPanel__tab--recent":"recent"===o,"StickersPanel__tab--editor":"editor"===o});return n.createElement("div",{key:o,className:c,style:i?{backgroundImage:"url('"+a+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}})})),l&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},n.createElement("span",{className:"StickersPanel__arrowIcon"})),d&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},n.createElement("span",{className:"StickersPanel__arrowIcon"}))),n.createElement(xe,{virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickersPanel__content",itemHeight:98},h.map(function(e,t){return n.createElement("div",{key:t,className:"StickersPanel__row"},e.map(function(e){var t=e.id,r=e.sizes;return n.createElement("div",{key:t,className:"StickersPanel__preview",onMouseDown:function(e){return o(e,t)}},n.createElement("img",{src:r[c.default.STICKER_MEDIUM],className:"StickersPanel__previewImage"}))}))})))},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,n=(t||[])[0],o=void 0===n?null:n;return!(!t||!o)&&o.sizes[c.default.STICKER_SMALL]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth;e&&(n=-n),r.setPosition(n,!0)}},r.setPosition=function(e,t){var n=r.scrollElement.current,o=r.props.ui.stickerHeaderScrollPosition;if(n){var a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(i)}},r.loadingLimit=25,r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r.needReset=!1,r}return Ce(t,e),t}(n.Component),Ne=Object(o.connect)(function(e){return{ui:e.ui,stickers:e.data.stickers}},function(e){return{deleteLayer:function(){return e(A())},setCurrentStickerPackIndex:function(t){return e(function(e){return{type:"SET_CURRENT_STICKER_PACK_INDEX",value:e}}(t))},setHeaderScrollPosition:function(t){return e(function(e){return{type:"SET_HEADER_SCROLL_POSITION",value:e}}(t))}}})(Le),ke=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ke(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"ColorPicker"},c.default.COLORS.map(function(t){var r=Object(ne.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":t===e.props.color});return n.createElement("div",{key:t,className:r,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}})}))},t}(n.Component),De=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ie=r("Cb16").default,je=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,o=e.setColor,a=e.setBrushWidth,i=e.setBrushOpacity;return r.updateDrawingPreview(),n.createElement("div",{className:"DrawPanel"},n.createElement("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:"270",height:"80"}),n.createElement("div",{className:"DrawPanel__sliders"},n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__sliderTitle"},Object(ve.getLang)("photos_pe_intensity")),n.createElement(Ie,{color:"#5181b8",defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return i(e)}})),n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__sliderTitle"},Object(ve.getLang)("photos_pe_line_width")),n.createElement(Ie,{color:"#5181b8",defaultValue:t.brushWidth,onChange:function(e){return a(e)}}))),n.createElement(Re,{color:t.color,setColor:o}),!!r.props.drawings.length&&n.createElement("div",{className:"DrawPanel__undo",onClick:r.undoDrawing},Object(ve.getLang)("photos_pe_undo_last_action")))},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var n=e.getContext("2d");if(n){var o=n.canvas,a=o.width,i=o.height,s=.2*a,u=.25*i,l=.8*a,d=u,f=a/2,p=1.2*i;n.clearRect(0,0,a,i),n.beginPath(),n.moveTo(s,u),n.quadraticCurveTo(f,p,l,d);var h="#FFFFFF"===t.color?"#F1F1F1":t.color;n.lineWidth=t.brushWidth*c.default.BRUSH_WIDTH_COEFFICIENT,n.strokeStyle=G(h,t.brushOpacity),n.lineJoin=n.lineCap="round",n.stroke()}}},r.undoDrawing=function(){r.props.undoDrawing()},r.previewCanvas=n.createRef(),r}return De(t,e),t}(n.Component),Ae=Object(o.connect)(function(e){return{settings:e.settings,drawings:e.drawings}},function(e){return{setColor:function(t){return e(U(t))},setBrushWidth:function(t){return e(function(e){return{type:"SET_SETTING_BRUSH_WIDTH",brushWidth:Math.max(.1,e)}}(t))},setBrushOpacity:function(t){return e(function(e){return{type:"SET_SETTING_BRUSH_OPACITY",brushOpacity:e}}(t))},undoDrawing:function(){return e(H())}}})(je),Me=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Be=r("Hx9h").default,Fe=r("TBLV").default,Ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,o=e.setColor,a=e.layer,i=e.fontsPlaceholders,s=a&&a.isEdit,u=a&&a.fontStyle,l=a&&a.color;return n.createElement("div",{className:"TextPanel"},t.props.ui.isShowDropBox&&n.createElement(Te,{onDelete:t.props.deleteLayer}),s?n.createElement(Be,{className:"TextPanelButton",onClick:t.props.closeTextEditor},Object(le.getLang)("photos_pe_save_action")):n.createElement(Be,{className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},n.createElement("div",{className:"TextPanelButton__icon"}),Object(le.getLang)("photos_pe_add_text")),n.createElement("div",{className:"TextPanelButton__fonts"},n.createElement("div",{className:"TextPanelButton__title"},Object(le.getLang)("photos_pe_font")),c.default.FONTS.map(function(e,o){return n.createElement(Fe,{key:e,value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:u?u===e:r.fontStyle===e},n.createElement("span",{className:"TextPanelButton__font PhotoEditorFontStyle--"+e},i[o]))})),n.createElement("div",{className:"TextPanelButton__colors"},n.createElement("div",{className:"TextPanelButton__title"},Object(le.getLang)("photos_pe_color")),n.createElement(Re,{color:l||r.color,setColor:o})))},t}return Me(t,e),t}(n.Component),He=Object(o.connect)(function(e){var t=e.layers,r=t.items,n=t.currentIndex,o=null;return null!==n&&(o=r[n]),{ui:e.ui,settings:e.settings,layer:o,fontsPlaceholders:e.data.fontsPlaceholders}},function(e){return{addLayerText:function(t,r){return e(I(t,r))},setColor:function(t){return e(U(t))},setFontSize:function(t){return e(function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(j({fontSize:e})),t({type:"SET_SETTING_FONT_SIZE",fontSize:e})}}(t))},setFontStyle:function(t){return e(function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(j({fontStyle:e})),t({type:"SET_SETTING_FONT_FAMILY",fontStyle:e})}}(t))},deleteLayer:function(){return e(A())},closeTextEditor:function(){return e(M())}}})(Ue),Ye=r("3oLO"),We=r("Egk5"),Ke=r("zxIV"),Ge=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xe=r("Hx9h").default,ze=r("6raB").default,Ve=r("PjZB").default,qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.componentDidMount=function(){window.addEventListener("keydown",t.handleKeyDown),window.addEventListener("mousedown",t.canvasMouseDown),t.getEditorData().then(function(e){var r=e.stickers,n=e.backgrounds,o=e.hash,a={};r.forEach(function(e){e.items.forEach(function(e){a[e.id]=e})}),t.props.setData({stickers:r,stickersMap:a,backgrounds:n,placeholders:Object(ve.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:Object(ve.getLang)("photos_pe_fonts").split("<br>"),hash:o}),t.props.setDataLoaded(),t.props.background.currentBackgroundType===c.default.BACKGROUND_MODES.BACKGROUND&&(t.props.addLayerText(!0,{isEdit:!0}),t.props.closeTextEditor(),t.props.setCurrentLayer(null)),t.prepareStickers(t.props.stickers)}).catch(function(){window.showFastBox({title:Object(ve.getLang)("global_error")},Object(ve.getLang)("global_error"),Object(ve.getLang)("global_close"),function(){window.curBox().hide(),t.props.data.close(!1,!0)})})},t.componentWillUnmount=function(){window.removeEventListener("keydown",t.handleKeyDown),window.removeEventListener("mousedown",t.canvasMouseDown),delete window.cur.storyPublishContext},t.getEditorData=function(){return new Promise(function(e,t){Ye.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})})},t.render=function(){var e,r=t.props,o=r.ui,a=r.data,i=r.drawings,s=r.layers;return a.artboardContainer||(e={width:a.artboardWidth,height:parseInt(a.artboardHeight)+c.default.BOTTOM_PANEL_HEIGHT}),t.isSaveDisabled=!0,a.context===c.default.CONTEXT_TYPES.STORY?t.isSaveDisabled=!1:t.isSaveDisabled=!s.items.length&&!i.length,n.createElement("div",{className:"PhotoEditor",style:{height:parseInt(a.artboardHeight)+c.default.BOTTOM_PANEL_HEIGHT}},n.createElement("div",{className:"PhotoEditor__canvas",style:e},n.createElement(be,{getStickerUrlById:t.getStickerUrlById})),n.createElement("div",{className:"PhotoEditor__tabs"},o.isDataLoaded?t.renderTabs():n.createElement(Ve,null)),!o.isDataLoaded&&t.renderFontsPreloading())},t.renderTabs=function(){var e=Object(ve.getLang)("photos_pe_save_action");return t.props.data.context===c.default.CONTEXT_TYPES.STORY&&(e=Object(ve.getLang)("photos_pe_publish_action")),n.createElement("div",{className:"PhotoEditor__inner"},n.createElement(Se,{current:t.props.ui.currentMode,change:t.props.setMode},n.createElement("div",{"data-mode":c.default.TABS.STICKERS},n.createElement(Ne,{stickerMouseDown:t.stickerDragStart})),n.createElement("div",{"data-mode":c.default.TABS.TEXT},n.createElement(He,null)),n.createElement("div",{"data-mode":c.default.TABS.PAINT},n.createElement(Ae,null))),n.createElement("div",{className:"PhotoEditor__actions"},n.createElement(Xe,{appearance:"secondary",onClick:t.props.data.close},Object(ve.getLang)("photos_pe_cancel_action")),n.createElement(ze,{appearance:"primary",loading:t.props.ui.isSaveLoading,disabled:t.isSaveDisabled,onClick:t.save},e)))},t.renderFontsPreloading=function(){return n.createElement("div",{className:"PhotoEditor__fontPreload"},c.default.FONTS.map(function(e){return n.createElement("span",{key:e,className:"PhotoEditorFontStyle--"+e})}))},t.save=function(){t.props.setCurrentLayer(null),t.props.setSaveLoading(!0),t.renderFinalImage().then(function(e){var r=t.props,n=r.layers,o=r.drawings,a=r.background,i=Object(L.prepareStat)(n.items,o,a.currentBackgroundType,a.currentBackgroundId);t.props.data.save(e,function(){t.props.setSaveLoading(!1)},{attachment:t.props.data.attachment,hash:t.props.data.hash,analytics:JSON.stringify(i)})}).catch(function(e){console.error(e)})},t.renderFinalImage=function(){return new Promise(function(e){var r=document.createElement("canvas"),n=r.getContext("2d"),o=document.querySelector(".EditorCanvas__canvas--bg"),a=document.querySelector(".EditorCanvas__canvas--draw"),i=document.getElementById("EditorCanvas__layers");if(n&&o&&a&&i){r.width=o.width,r.height=o.height,n.drawImage(o,0,0),n.drawImage(a,0,0);var s=t.props.data,c=s.artboardWidth,u=s.artboardHeight,l=s.addons,d=u;l&&l.photoHeight&&(d=l.photoHeight),x.a.toCanvas(i,{width:c,height:d,filter:function(e){return e.nodeType===Node.TEXT_NODE||!e.classList.contains("EditorLayer--sticker")}}).then(function(o){n.drawImage(o,0,0,r.width,r.height),t.renderCanvasLayers(n).then(function(){r.toBlob(function(t){e(t)},"image/jpeg",1)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}})},t.renderCanvasLayers=function(e){return new Promise(function(r,n){var o=t.props.data.originalWidth/t.props.data.artboardWidth,a=[];t.props.layers.items.forEach(function(r){r.type===c.default.LAYER_TYPES.STICKER&&a.push(t.renderCanvasSticker(e,r,o))}),Promise.all(a).then(r).catch(function(e){n(e)})})},t.renderCanvasSticker=function(e,r,n){return W(t.getStickerUrlById(r.id,c.default.STICKER_LARGE)).then(function(t){var o=r.width*n,a=r.height*n,i=(r.x-r.width/2)*n,s=(r.y-r.height/2)*n;e.save(),e.translate(i,s),e.translate(o/2,a/2),e.rotate(r.rotate*Math.PI/180),e.translate(-o/2,-a/2),e.drawImage(t,0,0,o,a),e.restore()})},t.handleKeyDown=function(e){if((e.ctrlKey||e.metaKey)&&90===e.keyCode&&t.props.ui.currentMode===c.default.TABS.PAINT&&t.props.undoDrawing(),null!==t.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(e.keyCode===We.KEY.DEL)e.preventDefault(),t.props.deleteLayer();else if([We.KEY.UP,We.KEY.DOWN,We.KEY.LEFT,We.KEY.RIGHT].includes(e.keyCode)){var r=t.getCurrentLayer();if(!r)return;var n={x:r.x,y:r.y},o=e.shiftKey?10:1;switch(e.keyCode){case We.KEY.UP:n.y-=o;break;case We.KEY.DOWN:n.y+=o;break;case We.KEY.LEFT:n.x-=o;break;case We.KEY.RIGHT:n.x+=o}t.props.updateLayer({x:n.x,y:n.y})}},t.canvasMouseDown=function(e){var r=t.getCurrentLayer(),n=e.target;if(r&&r.isFixed)t.layerDragFinish(e);else if("TEXTAREA"!==n.tagName)return!!n.closest(".EditorCanvas")&&(!n.closest(".SwitchMode")&&void(t.props.ui.currentMode!==c.default.TABS.PAINT&&(r&&r.type===c.default.LAYER_TYPES.TEXT&&r.isEdit?t.props.closeTextEditor():n.closest(".EditorLayer")?t.layerDragStart(e):r&&t.props.setCurrentLayer(null))))},t.getCurrentLayer=function(){var e=t.props.layers,r=e.items,n=e.currentIndex;return null===n?n:r[n]},t.layerDragStart=function(e,r){window.addEventListener("mousemove",t.layerDragProcess),window.addEventListener("mouseup",t.layerDragFinish);var n,o=e.target.closest("[data-index]");n=o?+Object(Ke.domData)(o,"index"):t.props.layers.currentIndex,t.props.layers.currentIndex!==n&&t.props.setCurrentLayer(n);var a=K(e,document.querySelector(".EditorCanvas__canvas--draw")),i=a.x,s=a.y,c=a.xOrigin,u=a.yOrigin;t.currentLayer=t.getCurrentLayer(),t.currentLayer&&(t.fromPanel=r,t.clientX=e.clientX,t.clientY=e.clientY,t.fromPanel?(t.shiftX=0,t.shiftY=0,t.shiftBodyX=0,t.shiftBodyY=0):(t.shiftX=i-t.currentLayer.x,t.shiftY=s-t.currentLayer.y,t.shiftBodyX=t.clientX-(t.currentLayer.x+c),t.shiftBodyY=t.clientY-(t.currentLayer.y+u)))},t.layerDragProcess=function(e){void 0!==t.shiftBodyX&&void 0!==t.shiftBodyY&&(t.props.updateLayer({x:Math.round(e.clientX-t.shiftBodyX),y:Math.round(e.clientY-t.shiftBodyY),isFixed:!0,isHide:!1}),t.fromPanel||t.props.ui.isShowDropBox||t.props.setShowDropBox(!0))},t.layerDragFinish=function(e){if(window.removeEventListener("mousemove",t.layerDragProcess),window.removeEventListener("mouseup",t.layerDragFinish),t.getCurrentLayer()&&t.currentLayer&&void 0!==t.shiftX&&void 0!==t.shiftY){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=K(e,r),o=n.x,a=n.y,i=r.getBoundingClientRect(),s=i.width,c=i.height,u=o-t.shiftX,l=a-t.shiftY,d=!1;if(t.fromPanel){var f=t.currentLayer.width/2,p=t.currentLayer.height/2;t.clientX===e.clientX&&t.clientY===e.clientY?(u=r.offsetWidth/2,l=r.offsetHeight/2):(u+f<0||u-f>s||l+p<0||l-p>c)&&(d=!0)}t.props.updateLayer({x:Math.round(u),y:Math.round(l),isFixed:!1,isHide:!1}),d&&t.props.deleteLayer(),t.props.setShowDropBox(!1),delete t.currentLayer,delete t.shiftX,delete t.shiftY,delete t.shiftBodyX,delete t.shiftBodyY,delete t.fromPanel,delete t.clientX,delete t.clientY}}},t.getStickerUrlById=function(e,r){var n=t.props.data.stickersMap[e];return n?n.sizes[r]:""},t.stickerDragStart=function(e,r){e.persist();var n=t.getCurrentLayer();if(!n||!n.isFixed){var o=document.querySelector(".EditorCanvas__canvas--draw");if(o){var a=c.default.LAYER_DEFAULT_SIZE/2,i=Math.floor(o.width/c.default.CANVAS_SCALE/2-a),s=Math.floor(o.height/c.default.CANVAS_SCALE/2-a);t.props.addLayerSticker({id:r,x:i,y:s,width:c.default.LAYER_DEFAULT_SIZE,height:c.default.LAYER_DEFAULT_SIZE,rotate:0,isHide:!0,isFixed:!1}),setTimeout(function(){t.layerDragStart(e.nativeEvent,!0)},0)}}},t.prepareStickers=function(e){e&&e.forEach(function(e){if(e){var r,n,o=t.props.data,a=o.artboardWidth,i=o.artboardHeight,s=e.sticker,u=s.transform,l=s.action,d=u.gravity,f=u.rotation,p=u.translation_x,h=void 0===p?0:p,y=u.translation_y,m=void 0===y?0:y,v=u.relation_width,g=0;void 0!==v&&(h=Math.min(Math.max(h,-1),1),m=Math.min(Math.max(m,-1),1),g=a*(v=Math.min(Math.max(v,.1),1)));var _=.5;if("renderable"===e.sticker_type){r=s.original_width;var E=(n=s.original_height)/r;g&&(n=(r=g)*E)}if("text"===s.action_type){g&&(_=t.getFontSize(l.text,l.style,g));var b=t.getTextRect(l.text,_*c.default.FONT_SIZE_COEFFICIENT,l.style);r=b.width,n=b.height}else r=c.default.LAYER_DEFAULT_SIZE,n=c.default.LAYER_DEFAULT_SIZE,g&&(r=g,n=g);var w=r/2,S=n/2,O=h*a,T=m*i,P=0,C=0;switch(d){case"left_top":P=w+O,C=S+T;break;case"left_center":P=w+O,C=i/2+T;break;case"left_bottom":P=w+O,C=i-S+T;break;case"center_top":P=a/2+O,C=S+T;break;case"center":P=a/2+O,C=i/2+T;break;case"center_bottom":P=a/2+O,C=i-S+T;break;case"right_top":P=a-w+O,C=S+T;break;case"right_center":P=a-w+O,C=i/2+T;break;case"right_bottom":P=a-w+O,C=i-S+T}if("renderable"===e.sticker_type)t.props.addLayerImage({url:s.url,x:P,y:C,width:r,height:n,rotate:-f,isFixed:!1});else switch(s.action_type){case"text":t.props.addLayerText(!1,{text:l.text,style:l.style,color:l.selection_color,fontSize:_,initialFontSize:_,rotate:-f,x:P,y:C});break;case"sticker":var x=l.pack_id+"_"+l.sticker_id;t.props.data.stickersMap[x]&&t.props.addLayerSticker({id:x,x:P,y:C,width:c.default.LAYER_DEFAULT_SIZE,height:c.default.LAYER_DEFAULT_SIZE,rotate:-f,isHide:!1,isFixed:!1})}}})},t.getTextRect=function(e,t,r){var n=document.createElement("span");n.innerHTML=e,n.style.display="inline-block",n.style.fontSize=t+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",n.classList.add("PhotoEditorFontStyle--"+r),document.body.append(n);var o=n.getBoundingClientRect();return n.remove(),o},t.getFontSize=function(e,t,r){var n=2*r,o=document.createElement("span");for(o.innerHTML=e,o.style.display="inline-block",o.style.width=r+"px",o.style.fontSize=n+"px",o.style.lineHeight="1em",o.style.whiteSpace="pre",o.classList.add("PhotoEditorFontStyle--"+t),document.body.append(o);n&&o.scrollWidth>Math.round(r);)n--,o.style.fontSize=n+"px";return o.remove(),n/100},t}return Ge(t,e),t}(n.Component),$e=Object(o.connect)(function(e){return{ui:e.ui,settings:e.settings,layers:e.layers,drawings:e.drawings,background:e.background,data:e.data}},function(e){return{setMode:function(t){return e(F(t))},addLayerSticker:function(t){return e(function(e){return Object(L.sendStat)(L.EVENTS.ADD_STICKER),D("ADD_LAYER_STICKER",{type:c.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,isHide:e.isHide,isFixed:e.isFixed})}(t))},addLayerText:function(t,r){return e(I(t,r))},addLayerImage:function(t){return e(function(e){return D("ADD_LAYER_IMAGE",{type:c.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,isFixed:e.isFixed})}(t))},updateLayer:function(t){return e(j(t))},undoDrawing:function(){return e(H())},deleteLayer:function(){return e(A())},setCurrentLayer:function(t){return e(R(t))},setDataLoaded:function(){return e({type:"SET_DATA_LOADED"})},setShowDropBox:function(t){return e(B(t))},setSaveLoading:function(t){return e(function(e){return{type:"SET_SAVE_LOADING",value:e}}(t))},closeTextEditor:function(){return e(M())},setData:function(t){return e(function(e){return{type:"SET_DATA",payload:e}}(t))}}})(qe),Ze=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Je=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getBackgroundType=function(){var e=c.default.CONTEXT_TYPES,r=c.default.BACKGROUND_MODES;return t.props.context===e.STORY?t.props.photoUrl?r.PHOTO:r.BACKGROUND:r.PHOTO},t}return Ze(t,e),t.prototype.render=function(){var e,t=(e={data:this.props,background:{currentBackgroundType:this.getBackgroundType(),currentPhotoUrl:this.props.photoUrl,currentBackgroundId:1}},Object(a.createStore)(P,e,i.composeWithDevTools(Object(a.applyMiddleware)(s.default))));return n.createElement(o.Provider,{store:t},n.createElement($e,{stickers:this.props.stickers}))},t.defaultProps={originalWidth:c.default.STORY_BASE_WIDTH,originalHeight:c.default.STORY_BASE_HEIGHT},t}(n.Component);r.d(t,"default",function(){return Je})},mYgU:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r("yOtm")),a=n(r("Ya8i")),i=n(r("WfVW")),s=n(r("xkiS")),c=n(r("t0N9")),u=r("Iwry");function l(e,t){return void 0===t&&(t={}),{width:t.width||u.getNodeWidth(e),height:t.height||u.getNodeHeight(e)}}function d(e,t){void 0===t&&(t={});var r=l(e,t),n=r.width,u=r.height;return o.default(e,t.filter,!0).then(function(e){return a.default(e,t)}).then(function(e){return i.default(e,t)}).then(function(e){return c.default(e,t)}).then(function(e){return s.default(e,n,u)})}function f(e,t){return void 0===t&&(t={}),d(e,t).then(u.createImage).then(u.delay(100)).then(function(r){var n=document.createElement("canvas"),o=n.getContext("2d"),a=u.getPixelRatio(),i=l(e,t),s=i.width,c=i.height;return n.width=s*a,n.height=c*a,n.style.width=""+s,n.style.height=""+c,o.scale(a,a),t.backgroundColor&&(o.fillStyle=t.backgroundColor,o.fillRect(0,0,n.width,n.height)),o.drawImage(r,0,0),n})}function p(e,t){void 0===t&&(t={});var r=l(e,t),n=r.width,o=r.height;return f(e,t).then(function(e){return e.getContext("2d").getImageData(0,0,n,o).data})}function h(e,t){return void 0===t&&(t={}),f(e,t).then(function(e){return e.toDataURL()})}function y(e,t){return void 0===t&&(t={}),f(e,t).then(function(e){return e.toDataURL("image/jpeg",t.quality||1)})}function m(e,t){return void 0===t&&(t={}),f(e,t).then(u.canvasToBlob)}t.toSvgDataURL=d,t.toCanvas=f,t.toPixelData=p,t.toPng=h,t.toJpeg=y,t.toBlob=m,t.default={toSvgDataURL:d,toCanvas:f,toPixelData:p,toPng:h,toJpeg:y,toBlob:m}},nAFc:function(e,t,r){"use strict";r.r(t),r.d(t,"encodeHTMLEntities",function(){return s}),r.d(t,"escape",function(){return c}),r.d(t,"decodeHTMLEntities",function(){return u}),r.d(t,"prepareToWriting",function(){return l});r("a1Th"),r("Btvt"),r("rE2o"),r("ioFf"),r("rGqo"),r("Oyvg"),r("pIFo");var n=r("yqpO"),o=r("vkmG");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var i=o.symbols,s=o.encodeHTMLEntities,c=o.escape;function u(e){return i.reduce((e,t)=>{var r=a(t,2),n=r[0],o=r[1];return e.replace(new RegExp(n,"ig"),o)},e).replace(/&#(\d+);/g,(e,t)=>String.fromCodePoint(t))}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.lineBreak,o=void 0!==r&&r,a=t.convertEmoji,i=void 0===a||a,s=u(e);return s=s.replace(/\n\r/gi,"\n"),"oneline"===o?s=s.replace(/<br>/gi," ").replace(/\n/gi," "):"html"===o&&(s=s.replace(/\n/gi,"<br>")),s=c(s),i&&(s=Object(n.emojiToHTML)(s,!0)),s}},qT12:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&Symbol.for,o=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,c=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,d=n?Symbol.for("react.async_mode"):60111,f=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,y=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116;function v(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case d:case f:case i:case c:case s:case h:return e;default:switch(e=e&&e.$$typeof){case l:case p:case u:return e;default:return t}}case m:case y:case a:return t}}}function g(e){return v(e)===f}t.typeOf=v,t.AsyncMode=d,t.ConcurrentMode=f,t.ContextConsumer=l,t.ContextProvider=u,t.Element=o,t.ForwardRef=p,t.Fragment=i,t.Lazy=m,t.Memo=y,t.Portal=a,t.Profiler=c,t.StrictMode=s,t.Suspense=h,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===f||e===c||e===s||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===y||e.$$typeof===u||e.$$typeof===l||e.$$typeof===p)},t.isAsyncMode=function(e){return g(e)||v(e)===d},t.isConcurrentMode=g,t.isContextConsumer=function(e){return v(e)===l},t.isContextProvider=function(e){return v(e)===u},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return v(e)===p},t.isFragment=function(e){return v(e)===i},t.isLazy=function(e){return v(e)===m},t.isMemo=function(e){return v(e)===y},t.isPortal=function(e){return v(e)===a},t.isProfiler=function(e){return v(e)===c},t.isStrictMode=function(e){return v(e)===s},t.isSuspense=function(e){return v(e)===h}},r7nW:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("i8i4"),a=(r("17x9"),r("pemR"));class i extends n.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,r=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=`${parseFloat(this.calculatedPadding)+r}px`),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose;!e.disableBackdropClick&&t()}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),r&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),r&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(a.classNames)("BaseModal",e);return n.createElement("div",{className:t,"aria-modal":"true"},n.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),n.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return o.createPortal(this.renderModal(),document.body)}}i.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=i},sINF:function(e,t,r){"use strict";function n(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}r.r(t);var o=n();o.withExtraArgument=n,t.default=o},t0N9:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e.style;return t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=t.width+"px"),t.height&&(r.height=t.height+"px"),t.style&&Object.assign(r,t.style),e}},ufMw:function(e,t,r){"use strict";r.r(t),r.d(t,"EVENTS",function(){return s}),r.d(t,"sendStat",function(){return c}),r.d(t,"prepareStat",function(){return u});var n=r("1y80"),o=r("98sY"),a=r("xYVc"),i=r("W9Tc"),s={ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",CANCEL_GRAFFITI:"cancel_graffiti",SELECT_BACKGROUND:"select_background"};function c(e){if(window.cur.storyPublishContext){var t={event_type:e,story_type:"photo"};Object(i.partConfigEnabled)("story_publish_analytics_log")&&Object(o.debugLog)(t),Object(n.statlogsValueEvent)("story_create_product_analytics",t)}}function u(e,t,r,n){var o=0,i="photo";r===a.default.BACKGROUND_MODES.BACKGROUND&&(i=(o=n)>100?"emojies":"gradients");var s={has_text:0,has_sticker:0,has_graffiti:0,background_type:i,background_id:o},c=[],u=[],l=[];return e.forEach(function(e){if(e.type===a.default.LAYER_TYPES.STICKER){var t=(i=e).id.split("_"),r=t[0],n=t[1],o=parseInt(r);c.push({id:parseInt(n),pack_id:o||0,type:o?"from_pack":"individual"})}else if(e.type===a.default.LAYER_TYPES.TEXT){var i=e;u.push({text:i.text,font:i.fontStyle,size:Math.round(i.fontSize*a.default.FONT_SIZE_COEFFICIENT),color:i.color.slice(1),background:"none",align:"center"})}}),u.length&&(s.has_text=1,s.texts=u),c.length&&(s.has_sticker=1,s.stickers=c),t.forEach(function(e){l.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})}),l.length&&(s.has_graffiti=1,s.graffities=l),s}},vRp6:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return c});r("a1Th"),r("Btvt"),r("rE2o"),r("ioFf"),r("rGqo");var n=r("q1tI"),o=(r("17x9"),r("UlUB")),a=r("PjZB"),i=r("pemR");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}class c extends n.Component{constructor(e){super(e),this.checkLoad=Object(o.default)(e=>{var t=s(e,3),r=t[0],n=t[1],o=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(n-r-o<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var r=this.state,n=this.getChildrenData(e,t||this.getScrollData()),o=n.start,a=n.end,i=n.before,s=n.after;o===r.start&&a===r.end&&i===r.before&&s===r.after||this.setState(n)}getChildrenData(e,t){var r=s(t,3),n=r[0],o=r[1],a=r[2],i=this.useWindowScroll?window:this.container,c=i&&i.offsetHeight;if(!i||0===o||0===a)return{start:0,end:0,before:0,after:e.length};a=Math.max(a,c);var u=e.length,l=Math.max(Math.floor(n/this.props.itemHeight)-1,0),d=Math.min(Math.floor((n+2*a)/this.props.itemHeight+1),u);return{start:l,end:d,before:l,after:u-d}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return n.createElement("div",{className:Object(i.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&n.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&n.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||n.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},n.createElement(a.default,null))))}}c.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vTYg:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry");function o(e,t,r){var o="."+e+":"+t,a=r.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(r):function(e){return n.toArray(e).map(function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")+";"}).join(" ")}(r);return document.createTextNode(o+"{"+a+"}")}t.default=function(e,t){[":before",":after"].forEach(function(r){return function(e,t,r){var a=window.getComputedStyle(e,r),i=a.getPropertyValue("content");if(""!==i&&"none"!==i){var s=n.uuid(),c=document.createElement("style");c.appendChild(o(s,r,a)),t.className=t.className+" "+s,t.appendChild(c)}}(e,t,r)})}},xYVc:function(e,t,r){"use strict";r.r(t);var n=r("t7n3");t.default={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:Object(n.isRetina)()?2:1,STICKER_SMALL:64,STICKER_MEDIUM:Object(n.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#E64646","#FF9300","#FFCB00","#62DA37","#00AEF9","#CC74E1"],FONTS:["classic","cursive","marker","italics","typewriter","poster"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"}}},xkiS:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry");t.default=function(e,t,r){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),i=document.createElementNS(o,"foreignObject");return a.setAttributeNS("","width",""+t),a.setAttributeNS("","height",""+r),i.setAttributeNS("","width","100%"),i.setAttributeNS("","height","100%"),i.setAttributeNS("","x","0"),i.setAttributeNS("","y","0"),i.setAttributeNS("","externalResourcesRequired","true"),a.appendChild(i),i.appendChild(e),n.svgToDataURL(a)}},yOtm:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("vTYg"));function i(e){return e instanceof HTMLCanvasElement?o.createImage(e.toDataURL()):e.tagName&&"svg"===e.tagName.toLowerCase()?Promise.resolve(e).then(function(e){return o.svgToDataURL(e)}).then(o.createImage):Promise.resolve(e.cloneNode(!1))}function s(e,t){return t instanceof Element?Promise.resolve().then(function(){return function(e,t){var r=window.getComputedStyle(e),n=t.style;r.cssText?n.cssText=r.cssText:o.toArray(r).forEach(function(e){n.setProperty(e,r.getPropertyValue(e),r.getPropertyPriority(e))})}(e,t)}).then(function(){return a.default(e,t)}).then(function(){return function(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}(e,t)}).then(function(){return t}):t}function c(e,t,r){return r||!t||t(e)?Promise.resolve(e).then(i).then(function(r){return function(e,t,r){var n=o.toArray(e.childNodes);return 0===n.length?Promise.resolve(t):n.reduce(function(e,n){return e.then(function(){return c(n,r)}).then(function(e){e&&t.appendChild(e)})},Promise.resolve()).then(function(){return t})}(e,r,t)}).then(function(t){return s(e,t)}):Promise.resolve(null)}t.default=c}});